# 185. Department Top Three Salaries

## **Hard**

[Problem](https://leetcode.com/problems/department-top-three-salaries/)

## Things to notice
- `RANK` window functions has NO parameters in the parenthesis!!\
  e.g.: \
  `DENSE_RANK() OVER (PARTITION BY ... ORDER BY...)`\
  (because they order by clause is in OVER part)
  
## Solutions
- method 1:\
  window function. <- *"TOP xxx in different groups" question*\
  \
  Mindset:\
  ![IMG_0397](https://user-images.githubusercontent.com/51430523/142371672-57c38ce8-4e72-4077-9642-142445daa39b.jpg)

```mysql

SELECT t.dep AS Department,
       t.employee AS Employee,
       t.salary AS Salary
FROM
(SELECT d.name AS dep,
        e.name AS employee,
        e.salary AS salary,
        DENSE_RANK() OVER (PARTITION BY e.departmentId ORDER BY salary DESC) AS rank_s
FROM Employee e JOIN Department d
ON e.departmentId = d.id) AS t
WHERE t.rank_s <= 3;

```


- method 2:\
  self-join.

  Note:
  - GROUP BY full 1,2,3, instead of only 1 `t2.departmentId`. Otherwise, break it.
    
```mysql
WITH cte AS
    (
    SELECT 
        t2.departmentId,
        t2.name,
        t2.salary,
        count(distinct t1.salary) AS ranks
    FROM Employee t1 INNER JOIN Employee t2
        ON t1.departmentId = t2.departmentId
            AND t1.salary >= t2.salary
    GROUP BY 1,2,3
    HAVING count(DISTINCT t1.salary) <= 3
)

SELECT
    t2.name AS Department,
    t1.name AS Employee,
    salary AS Salary
FROM cte t1 INNER JOIN Department t2
    ON t1.departmentId = t2.id
;
```


- method 3:\
  join.

```mysql

SELECT
    d.Name AS 'Department', e1.Name AS 'Employee', e1.Salary
FROM
    Employee e1
        JOIN
    Department d ON e1.DepartmentId = d.Id
WHERE
    3 >= (SELECT
            COUNT(DISTINCT e2.Salary)
        FROM
            Employee e2
        WHERE
            e2.Salary >= e1.Salary
                AND e1.DepartmentId = e2.DepartmentId
        )
;
```
